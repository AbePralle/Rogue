$include "Standard/Boss.rogue"
$using Boss

class Robot
  GLOBAL PROPERTIES
    phrases = String[] ...
    [
      "I AM ROBOT",
      "ROBOT LOVES KITTEN",
      "ALL YOUR BASE ARE BELONG TO ROBOT"
    ]

  PROPERTIES
    next_phrase = 0

  METHODS
    method init
      println "Creating robot"

    method speak
      println phrases[ next_phrase ]
      ++next_phrase
      next_phrase %= phrases.count
endClass

local vm = VM()

vm.register( "Robot", 0,
  function(task:Task)
    task.push_object( Robot() )
  endFunction
)

vm.register( "Robot.speak", 0,
  function(task:Task)
    (task.object_arg(0) as Robot).speak
    task.push_this
  endFunction
)

vm.register( "println", 0,
  function(task:Task)
    forEach (i in 1..task.arg_count)
      print task.arg(i)
    endForEach
    println
    task.push( null )
  endFunction
)

#local task = vm.execute( "Robot()" )

vm.execute @|println 5, 6, 7+8
            |println null
            |println 1
            |println 2*3+4*5
            |println 1 + " " + 2
            |println 1 + 2 + " " + 3 + 4
            |println 2+3*4+5
            |println Robot()
            |Robot().speak.speak.speak.speak
            |local x = 5
            |println x
            |local x = Robot()
            |x.speak
            |x.speak

